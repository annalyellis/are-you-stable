<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Balance Quiz & Visualization</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f7f6;
      color: #333;
      overflow: hidden; /* Prevent body scroll when panels are active */
    }

    #quizContainer {
      padding: 20px;
      transition: opacity 0.5s ease;
      max-width: 800px;
      margin: 20px auto;
      background-color: #fff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      max-height: 90vh;
      overflow-y: auto;
    }

    /* Main Content Wrapper - always takes full screen, manages its children */
    #mainContent {
      display: flex; /* Always flex to manage resultsPane and visualizationArea */
      height: 100vh;
      width: 100vw;
      opacity: 0;
      transition: opacity 0.5s ease;
      pointer-events: none; /* Disable interactions when hidden */
      position: relative;
      overflow: hidden;
      /* Initial state: hidden */
      display: none; /* Add this to ensure it's hidden on load */
    }

    /* Results Pane - default state (expanded sidebar) */
    #resultsPane {
      flex: 0 0 350px; /* Fixed width sidebar when split */
      background-color: #fff;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
      overflow-y: auto;
      transition: flex-basis 0.5s ease, width 0.5s ease, height 0.5s ease,
                  top 0.5s ease, right 0.5s ease, bottom 0.5s ease, left 0.5s ease,
                  padding 0.5s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      position: relative; /* For the toggle button */
      z-index: 100; /* Ensure it's above vizArea when overlapping (minimized state) */
    }

    /* Results Pane - full screen state (after quiz, before viz transition) */
    #resultsPane.full-screen-results {
      flex: 1; /* Takes full width of mainContent */
      position: relative;
      width: auto;
      height: 100%;
      padding: 20px;
      justify-content: center; /* Center content vertically */
      align-items: center; /* Center content horizontally */
      box-shadow: none; /* Remove shadow for full screen */
      text-align: center; /* Center text content */
    }
    #resultsPane.full-screen-results .toggle-button {
        display: none; /* Hide toggle button in this state */
    }
    /* Ensure content within full-screen-results is also centered/readable */
    #resultsPane.full-screen-results h2,
    #resultsPane.full-screen-results #scoreInterpretation,
    #resultsPane.full-screen-results #recommendations {
        max-width: 700px; /* Limit width for readability */
        margin: 10px auto; /* Center blocks */
    }


    /* Visualization Area - takes remaining space, will scroll */
    #visualizationArea {
      flex-grow: 1; /* Always takes remaining space in flex container */
      background-color: #f4f7f6;
      padding: 20px; /* Overall padding for the scrollable area */
      overflow-y: auto; /* Enable scrolling for multiple visualizations */
      position: relative;
      transition: opacity 0.5s ease;
      display: flex; /* Default display as flex to allow contents to stack */
      flex-direction: column;
      gap: 30px; /* Space between viz containers */
      /* Initial state: hidden */
      display: none; /* Add this to ensure it's hidden on load */
    }


    /* Styles for the minimized results pane (corner element) */
    #resultsPane.minimized {
        position: fixed; /* Fixed position relative to viewport, takes it out of flex flow */
        bottom: 20px;
        right: 20px;
        width: 150px;
        height: 100px;
        flex: none; /* Override flex properties when fixed */
        padding: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        border-radius: 12px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        overflow: hidden; /* Hide overflowing content */
        z-index: 1000; /* Ensure it's on top */
        background-color: rgba(255, 255, 255, 0.95);
    }
    #resultsPane.minimized > *:not(.toggle-button, #predictedScore) {
        display: none; /* Hide most content when minimized */
    }
    #resultsPane.minimized #predictedScore {
        display: block; /* Always show score */
        font-size: 1.4em;
        font-weight: bold;
        color: #2c3e50;
        margin-top: 0;
        text-align: center;
    }
    #resultsPane.minimized .toggle-button {
        position: absolute;
        top: 5px;
        right: 5px;
        font-size: 0.7em;
        padding: 3px 8px;
        background-color: #007bff;
        color: white;
        border-radius: 3px;
    }
    #resultsPane.minimized .toggle-button:hover {
        background-color: #0056b3;
    }

    h1, h2, h3 {
      color: #2c3e50;
      text-align: center;
    }

    .progress-bar {
      width: 100%;
      background-color: #e0e0e0;
      border-radius: 5px;
      margin-bottom: 20px;
      position: sticky;
      top: 0;
      background-color: #fff;
      padding-top: 10px;
      z-index: 10;
    }

    .progress-fill {
      height: 15px;
      background-color: #4CAF50;
      border-radius: 5px;
      width: 0%;
      transition: width 0.4s ease-in-out;
    }

    .step {
      display: none;
    }

    .step.active {
      display: block;
    }

    .question {
      margin-bottom: 20px;
      padding: 10px;
      border: 1px solid #eee;
      border-radius: 5px;
      background-color: #fafafa;
    }

    .question label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #555;
    }

    .question input[type="number"], .question select {
      width: calc(100% - 12px);
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .likert-scale {
      display: flex;
      justify-content: space-around;
      margin-top: 10px;
    }

    .likert-option {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      text-align: center;
      cursor: pointer;
      background-color: #f0f0f0;
      transition: background-color 0.3s ease, border-color 0.3s ease;
      margin: 0 5px;
    }

    .likert-option:hover {
      background-color: #e0e0e0;
    }

    .likert-option.selected {
      background-color: #28a745;
      color: white;
      border-color: #28a745;
    }

    .tmt-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
      gap: 15px;
      width: 100%;
      max-width: 400px;
      margin: 20px auto;
      border: 2px dashed #ccc;
      padding: 20px;
      border-radius: 10px;
    }

    .tmt-circle {
      width: 50px;
      height: 50px;
      background-color: #007bff;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s ease, transform 0.2s ease;
    }

    .tmt-circle:hover {
      background-color: #0056b3;
      transform: scale(1.05);
    }

    .tmt-circle.current {
      background-color: #ffc107;
      color: #333;
      border: 2px solid #333;
      transform: scale(1.1);
    }

    .tmt-circle.completed {
      background-color: #28a745;
      color: white;
      opacity: 0.7;
    }

    .tmt-timer {
      text-align: center;
      font-size: 1.4em;
      margin-top: 15px;
      font-weight: bold;
      color: #333;
    }

    .navigation-buttons {
      text-align: center;
      margin-top: 30px;
      position: sticky;
      bottom: 0;
      background-color: #fff;
      padding-bottom: 10px;
      z-index: 10;
    }

    .navigation-buttons button {
      padding: 12px 25px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      margin: 0 10px;
      transition: background-color 0.3s ease;
    }

    .navigation-buttons button#prevBtn {
      background-color: #6c757d;
      color: white;
    }

    .navigation-buttons button#prevBtn:hover {
      background-color: #5a6268;
    }

    .navigation-buttons button#nextBtn, #submitBtn {
      background-color: #007bff;
      color: white;
    }

    .navigation-buttons button#nextBtn:hover, #submitBtn:hover {
      background-color: #0056b3;
    }

    .navigation-buttons button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }

    #resultsSection p, #resultsSection ul {
      font-size: 1.1em;
      line-height: 1.6;
    }

    #comparisonChart {
      margin-top: 20px;
      text-align: center;
    }

    #comparisonChart svg {
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      width: 100%; /* Take full width of its container */
      height: 250px;
    }

    .download-button, .back-button, .viz-nav-button {
      display: inline-block;
      width: fit-content;
      margin: 5px;
      padding: 8px 15px;
      background-color: #17a2b8;
      color: white;
      border-radius: 5px;
      text-decoration: none;
      text-align: center;
      transition: background-color 0.3s ease;
      border: none;
      cursor: pointer;
      font-size: 0.9em;
    }

    .download-button:hover, .back-button:hover, .viz-nav-button:hover {
      background-color: #138496;
    }

    .back-button {
      background-color: #f0ad4e;
    }

    .back-button:hover {
      background-color: #ec971f;
    }

    /* Visualization Area Specific Styles */
    .viz-container {
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      padding: 20px 40px; /* Increased horizontal padding for text on sides */
      margin-bottom: 20px; /* Space between viz containers */
      display: block; /* All viz containers are displayed by default */
    }

    .viz-content {
        display: flex;
        flex-direction: column; /* Stack text and SVG vertically */
        align-items: center; /* Center content horizontally */
        gap: 15px; /* Space between text and SVG */
    }

    .viz-content p {
        max-width: 800px; /* Limit text width for readability */
        text-align: justify;
        line-height: 1.6;
        color: #555;
    }


    .viz-container svg {
      width: 100%;
      height: 350px;
      background-color: #f9f9f9; /* Slightly different background for SVG area */
      border-radius: 6px;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.08); /* Subtle inner shadow */
    }

    /* General toggle button style */
    .toggle-button {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: #5cb85c;
        color: white;
        margin: 5px;
        font-size: 0.8em;
        padding: 5px 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        z-index: 101; /* Ensure toggle button is always clickable */
    }

    .toggle-button:hover {
        background-color: #449d44;
    }
    .explore-results-btn {
      background-color: #4CAF50;
      color: white;
      padding: 15px 30px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
      transition: background-color 0.3s;
    }

    .explore-results-btn:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>

  <div id="quizContainer">
    <h1>Balance Assessment Quiz</h1>
    <div class="progress-bar">
      <div id="progressFill" class="progress-fill"></div>
    </div>

    <div id="step0" class="step active">
      <h2>Welcome to the Balance Assessment!</h2>
      <p>This quiz will assess your balance and provide personalized insights. It involves several steps, including questions about your physical activity and a simple motor test.</p>
      <div class="navigation-buttons">
        <button id="startQuizBtn" onclick="goToStep(1)">Start Quiz</button>
      </div>
    </div>

    <div id="step1" class="step">
      <h2>1. Personal Information</h2>
      <div class="question">
        <label for="age">Age:</label>
        <input type="number" id="age" name="age" min="1" max="120" required>
      </div>
      <div class="question">
        <label for="gender">Gender:</label>
        <select id="gender" name="gender" required>
          <option value="">Select</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="other">Other</option>
        </select>
      </div>
      <div class="question">
        <label for="height">Height (inches):</label>
        <input type="number" id="height" name="height" min="20" max="100" step="0.1" required>
      </div>
      <div class="question">
        <label for="weight">Weight (pounds):</label>
        <input type="number" id="weight" name="weight" min="50" max="1000" step="0.1" required>
      </div>
      <div class="navigation-buttons">
        <button id="prevBtn1" onclick="prevStep()" style="display: none;">Previous</button>
        <button id="nextBtn1" onclick="nextStep()">Next</button>
      </div>
    </div>

    <div id="step2" class="step">
      <h2>2. Falls Efficacy Scale - International (FES-I)</h2>
      <p>Please indicate your level of concern about falling during the following activities:</p>
      <div id="fesQuestions">
        </div>
      <div class="navigation-buttons">
        <button id="prevBtn2" onclick="prevStep()">Previous</button>
        <button id="nextBtn2" onclick="nextStep()">Next</button>
      </div>
    </div>

    <div id="step3" class="step">
      <h2>3. International Physical Activity Questionnaire (IPAQ)</h2>
      <div class="question">
        <label for="ipaq1a">In the last 7 days, on how many days did you do **vigorous** physical activities like heavy lifting, digging, aerobics, or fast bicycling?</label>
        <input type="number" id="ipaq1a" name="ipaq1a" min="0" max="7" required>
      </div>
      <div class="question">
        <label for="ipaq1b">How much time did you spend on one of those days doing vigorous physical activities? (minutes per day)</label>
        <input type="number" id="ipaq1b" name="ipaq1b" min="0" required>
      </div>
      <div class="question">
        <label for="ipaq2a">In the last 7 days, on how many days did you do **moderate** physical activities like carrying light loads, bicycling at a regular pace, or doubles tennis? (Don't include walking)</label>
        <input type="number" id="ipaq2a" name="ipaq2a" min="0" max="7" required>
      </div>
      <div class="question">
        <label for="ipaq2b">How much time did you spend on one of those days doing moderate physical activities? (minutes per day)</label>
        <input type="number" id="ipaq2b" name="ipaq2b" min="0" required>
      </div>
      <div class="navigation-buttons">
        <button id="prevBtn3" onclick="prevStep()">Previous</button>
        <button id="nextBtn3" onclick="nextStep()">Next</button>
      </div>
    </div>

    <div id="step4" class="step">
      <h2>4. Trail Making Test (TMT) - Part A (Numbers)</h2>
      <p>Click on the numbers in ascending order (1, 2, 3, ...). The timer starts when you click 'Start'.</p>
      <div class="tmt-grid" id="tmtGrid">
        </div>
      <div class="tmt-timer" id="tmtTimer">Ready to start</div>
      <div class="navigation-buttons">
        <button id="tmtStartBtn" onclick="startTMT()">Start Test</button>
        <button id="prevBtn4" onclick="prevStep()">Previous</button>
        <button id="tmtNextBtn" onclick="nextStep()" disabled>Next</button>
      </div>
    </div>

    <div id="step5" class="step">
      <h2>5. Submit Assessment</h2>
      <p>Click 'Submit' to calculate your balance score and see your personalized results.</p>
      <div class="navigation-buttons">
        <button id="prevBtn5" onclick="prevStep()">Previous</button>
        <button id="submitBtn" onclick="calculateResults()">Submit</button>
      </div>
    </div>
  </div>

  <div id="mainContent">
    <div id="resultsPane">
        <button class="toggle-button" onclick="toggleResultsPane()">Minimize Results</button>
        <h2>Your Predicted Mini-BESTest Score: <span id="predictedScore"></span></h2>
        <div id="scoreInterpretation"></div>
        <div id="recommendations"></div>
        <div id="comparisonChart"></div> <div style="text-align: center; margin-top: 20px;">
            <button class="download-button" onclick="downloadScore()">Download My Score</button>
            <a href="#" id="downloadResultsBtn" class="download-button" onclick="downloadResults()">Download All Results (JSON)</a>
            <button class="download-button" onclick="resetAssessment()">Start New Assessment</button>
        </div>
    </div>
    <div id="visualizationArea">
        <div id="viz1" class="viz-container">
            <h2>Balance Over Time (Example)</h2>
            <div class="viz-content">
                <p>This graph illustrates a hypothetical trend of your balance performance over several simulated periods. A higher line indicates better balance. Observe how different factors might influence your stability, such as fatigue or activity levels.</p>
                <svg width="100%" height="300"></svg> <p>Understanding the fluctuations in your balance can help identify patterns and areas for improvement. Consistent activity often leads to more stable balance over time.</p>
            </div>
        </div>
        <div id="viz2" class="viz-container">
            <h2>Visualization 2: Sample Bar Chart - Activity Impact</h2>
            <div class="viz-content">
                <p>This bar chart shows the perceived impact of different physical activities on your balance. Taller bars indicate a stronger positive correlation with improved balance, based on your self-reported activity levels.</p>
                <svg width="100%" height="300"></svg>
                <p>Engaging in activities that challenge your balance, even moderately, can significantly contribute to overall stability and reduce fall risk. Consider diversifying your exercise routine.</p>
            </div>
        </div>
        <div id="viz3" class="viz-container">
            <h2>Visualization 3: Sample Pie Chart - Risk Factor Distribution</h2>
            <div class="viz-content">
                <p>This pie chart breaks down the contributing factors to your current balance assessment, highlighting the relative influence of elements like age, physical activity, and concern about falling (FES-I score).</p>
                <svg width="100%" height="300"></svg>
                <p>Identifying key risk factors can help tailor interventions. For instance, if fear of falling is a large segment, targeted strategies to build confidence and reduce anxiety around movement can be very beneficial.</p>
            </div>
        </div>
        </div>
  </div>

  <script>
    let currentStep = 0;
    let assessmentData = {};
    let tmtStartTime = null;
    let tmtCurrentNumber = 1;
    let tmtCompleted = false;
    let finalPredictedScore = null; // Stores the final score for download
    let autoTransitionTimeout; // To store the timeout ID for auto-transitioning to viz page

    // FES-I Questions - A static list of questions for the FES-I section
    const fesQuestions = [
        "Cleaning the house (e.g. sweep, vacuum, or dust)",
        "Getting dressed or un-dressed",
        "Preparing simple meals",
        "Taking a bath or shower",
        "Going to the shop",
        "Getting in or out of a chair",
        "Going up or down stairs",
        "Walking around the house",
        "Walking on a slippery surface (e.g. wet floor, ice)",
        "Walking on an uneven surface (e.g. stony path, grass)",
        "Walking in a place with crowds (e.g. shopping center, street)",
        "Walking up or down a slope",
        "Visiting friends or relatives",
        "Going to a place with stairs or steps",
        "Going for a social event (e.g. club, religious meeting, party)",
        "Going to the doctor’s clinic or hospital"
    ];

    /**
     * Initializes the quiz on page load.
     * Sets the initial step to the welcome screen and prepares dynamic elements.
     */
    window.onload = function() {
        goToStep(0); // Show the welcome step first
        initializeFESQuestions();
        initializeTMT();
        // Initially hide the main content split view using CSS directly, not JS here
        // The CSS for #mainContent and #visualizationArea now includes display: none; by default
    };

    /**
     * Navigates to a specific quiz step.
     * @param {number} stepNum - The number of the step to go to.
     */
    function goToStep(stepNum) {
        document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
        currentStep = stepNum;
        document.getElementById(`step${stepNum}`).classList.add('active');
        updateProgress();

        // Manage navigation button visibility
        const prevBtns = [
            document.getElementById('prevBtn1'),
            document.getElementById('prevBtn2'),
            document.getElementById('prevBtn3'),
            document.getElementById('prevBtn4'),
            document.getElementById('prevBtn5')
        ];
        prevBtns.forEach(btn => {
            if (btn) { // Check if the button exists
                btn.style.display = (currentStep > 1 && currentStep <= 5) ? 'inline-block' : 'none';
            }
        });
    }

    /**
     * Updates the progress bar based on the current quiz step.
     */
    function updateProgress() {
        const totalSteps = 5; // Total assessment steps (1 to 5)
        const adjustedStep = Math.max(0, currentStep - 1); // Current step for progress bar (0 to 4)
        const progress = (adjustedStep / totalSteps) * 100;
        document.getElementById('progressFill').style.width = `${progress}%`;
    }

    /**
     * Dynamically creates and displays the FES-I questions.
     * Pre-selects options if data already exists (e.g., on 'Previous' button click).
     */
    function initializeFESQuestions() {
        const container = document.getElementById('fesQuestions');
        container.innerHTML = ''; // Clear existing questions
        fesQuestions.forEach((question, index) => {
            const questionId = `fes${index + 1}`;
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question';
            questionDiv.innerHTML = `
                <label>${index + 1}. ${question}</label>
                <div class="likert-scale">
                    <div class="likert-option" data-value="1" onclick="selectLikert(this, '${questionId}', 1)">
                        <div>Not at all concerned</div>
                        <div><strong>1</strong></div>
                    </div>
                    <div class="likert-option" data-value="2" onclick="selectLikert(this, '${questionId}', 2)">
                        <div>Somewhat concerned</div>
                        <div><strong>2</strong></div>
                    </div>
                    <div class="likert-option" data-value="3" onclick="selectLikert(this, '${questionId}', 3)">
                        <div>Fairly concerned</div>
                        <div><strong>3</strong></div>
                    </div>
                    <div class="likert-option" data-value="4" onclick="selectLikert(this, '${questionId}', 4)">
                        <div>Very concerned</div>
                        <div><strong>4</strong></div>
                    </div>
                </div>
            `;
            container.appendChild(questionDiv);

            // If a value is already stored, pre-select the option
            if (assessmentData[questionId]) {
                const selectedOption = questionDiv.querySelector(`.likert-option[data-value="${assessmentData[questionId]}"]`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                }
            }
        });
    }

    /**
     * Handles the selection of a Likert scale option.
     * Stores the selected value in `assessmentData`.
     * @param {HTMLElement} element - The clicked Likert option element.
     * @param {string} questionId - The ID of the question (e.g., 'fes1').
     * @param {number} value - The numerical value of the selected option.
     */
    function selectLikert(element, questionId, value) {
        element.parentNode.querySelectorAll('.likert-option').forEach(opt => {
            opt.classList.remove('selected');
        });
        element.classList.add('selected');
        assessmentData[questionId] = value;
    }

    /**
     * Converts height from inches to centimeters and weight from pounds to kilograms.
     * @param {number} heightInInches - Height in inches.
     * @param {number} weightInPounds - Weight in pounds.
     * @returns {{heightCm: number, weightKg: number}} - Object with converted values.
     */
    function convertToMetric(heightInInches, weightInPounds) {
        const heightCm = heightInInches * 2.54;
        const weightKg = weightInPounds * 0.453592;
        return { heightCm, weightKg };
    }

    /**
     * Initializes the Trail Making Test (TMT) grid.
     * Generates and shuffles numbers for the test.
     */
    function initializeTMT() {
        const grid = document.getElementById('tmtGrid');
        grid.innerHTML = ''; // Clear existing circles
        const numbers = Array.from({length: 13}, (_, i) => i + 1); // Numbers 1 to 13

        // Shuffle positions for a random layout
        const shuffled = numbers.sort(() => Math.random() - 0.5);

        shuffled.forEach(num => {
            const circle = document.createElement('div');
            circle.className = 'tmt-circle';
            circle.textContent = num;
            circle.dataset.number = num;
            circle.onclick = () => clickTMTNumber(num, circle);
            grid.appendChild(circle);
        });

        // Reset TMT state for re-initialization
        document.getElementById('tmtTimer').textContent = 'Ready to start';
        document.getElementById('tmtStartBtn').style.display = 'inline-block';
        document.getElementById('tmtNextBtn').disabled = true;
    }

    /**
     * Starts the Trail Making Test timer and highlights the first number.
     */
    function startTMT() {
        tmtStartTime = Date.now();
        tmtCurrentNumber = 1;
        tmtCompleted = false;

        document.getElementById('tmtStartBtn').style.display = 'none';
        const firstCircle = document.querySelector('[data-number="1"]');
        if (firstCircle) {
            firstCircle.classList.add('current');
        }

        updateTMTTimer();
    }

    /**
     * Updates the TMT timer display.
     * Uses `requestAnimationFrame` for smooth updates.
     */
    function updateTMTTimer() {
        if (!tmtStartTime || tmtCompleted) return;

        const elapsed = (Date.now() - tmtStartTime) / 1000;
        document.getElementById('tmtTimer').textContent = `Time: ${elapsed.toFixed(1)}s`;

        requestAnimationFrame(updateTMTTimer);
    }

    /**
     * Handles clicks on TMT numbers.
     * Validates if the correct number is clicked and tracks progress.
     * @param {number} number - The number on the clicked circle.
     * @param {HTMLElement} element - The clicked circle element.
     */
    function clickTMTNumber(number, element) {
        if (!tmtStartTime || tmtCompleted) return;

        if (number === tmtCurrentNumber) {
            element.classList.remove('current');
            element.classList.add('completed');

            tmtCurrentNumber++;

            if (tmtCurrentNumber <= 13) {
                const nextCircle = document.querySelector(`[data-number="${tmtCurrentNumber}"]`);
                if (nextCircle) {
                    nextCircle.classList.add('current');
                }
            } else {
                // Test completed
                tmtCompleted = true;
                const totalTime = (Date.now() - tmtStartTime) / 1000;
                assessmentData.tmtTime = totalTime;

                document.getElementById('tmtTimer').textContent = `Completed in ${totalTime.toFixed(1)}s`;
                document.getElementById('tmtNextBtn').disabled = false;
            }
        }
    }

    /**
     * Moves to the next quiz step after validating the current step.
     */
    function nextStep() {
        if (!validateCurrentStep()) {
            alert('Please complete all required fields for this step.');
            return;
        }

        collectCurrentStepData();

        document.getElementById(`step${currentStep}`).classList.remove('active');
        currentStep++;
        goToStep(currentStep);

        if (currentStep > 5) { // If it's past the last quiz step, calculate results
            calculateResults();
        }
    }

    /**
     * Moves to the previous quiz step.
     */
    function prevStep() {
        document.getElementById(`step${currentStep}`).classList.remove('active');
        currentStep--;
        goToStep(currentStep);
    }

    /**
     * Validates that all required fields for the current step are filled.
     * @returns {boolean} - True if validation passes, false otherwise.
     */
    function validateCurrentStep() {
        if (currentStep === 1) {
            return document.getElementById('age').value &&
                   document.getElementById('gender').value &&
                   document.getElementById('height').value &&
                   document.getElementById('weight').value;
        } else if (currentStep === 2) {
            // Check if all FES questions have a selected value
            return fesQuestions.every((_, i) => assessmentData[`fes${i + 1}`] !== undefined);
        } else if (currentStep === 3) {
            return document.getElementById('ipaq1a').value !== '' &&
                   document.getElementById('ipaq1b').value !== '' &&
                   document.getElementById('ipaq2a').value !== '' &&
                   document.getElementById('ipaq2b').value !== '';
        } else if (currentStep === 4) {
            return tmtCompleted;
        }
        return true;
    }

    /**
     * Collects data from the current quiz step and stores it in `assessmentData`.
     */
    function collectCurrentStepData() {
        if (currentStep === 1) {
            assessmentData.age = parseInt(document.getElementById('age').value);
            assessmentData.gender = document.getElementById('gender').value;

            const heightInches = parseFloat(document.getElementById('height').value);
            const weightPounds = parseFloat(document.getElementById('weight').value);

            // Convert to metric
            const { heightCm, weightKg } = convertToMetric(heightInches, weightPounds);

            // Save converted values
            assessmentData.height = heightCm;
            assessmentData.weight = weightKg;
            assessmentData.bmi = weightKg / ((heightCm / 100) ** 2);

        } else if (currentStep === 3) {
            assessmentData.ipaq1a = parseInt(document.getElementById('ipaq1a').value) || 0;
            assessmentData.ipaq1b = parseInt(document.getElementById('ipaq1b').value) || 0;
            assessmentData.ipaq2a = parseInt(document.getElementById('ipaq2a').value) || 0;
            assessmentData.ipaq2b = parseInt(document.getElementById('ipaq2b').value) || 0;
        }
        // FES data is collected in `selectLikert`
        // TMT data is collected in `clickTMTNumber`
    }

    /**
     * Calculates the predicted Mini-BESTest score based on collected assessment data.
     * This is a simplified prediction model for demonstration purposes.
     */
    function calculateResults() {
        // Calculate FES total score
        let fesTotal = 0;
        fesQuestions.forEach((_, i) => {
            fesTotal += assessmentData[`fes${i + 1}`] || 1; // Default to 1 if not selected
        });
        assessmentData.fesTotal = fesTotal;

        // Calculate IPAQ score (simplified MET calculation)
        // METs: Vigorous = 8, Moderate = 4
        const vigorousMets = assessmentData.ipaq1a * assessmentData.ipaq1b * 8;
        const moderateMets = assessmentData.ipaq2a * assessmentData.ipaq2b * 4;
        assessmentData.ipaqScore = vigorousMets + moderateMets;

        // Predict Mini-BESTest score using simplified model (max 28)
        let predictedScore = 28; // Base score

        // Age factor
        if (assessmentData.age > 65) predictedScore -= 3;
        else if (assessmentData.age > 45) predictedScore -= 1;

        // BMI factor
        if (assessmentData.bmi > 30) predictedScore -= 2;
        else if (assessmentData.bmi < 18.5) predictedScore -= 1;

        // FES factor (higher concern = lower balance)
        // FES-I score ranges from 16 (no concern) to 64 (severe concern).
        if (fesTotal >= 40) predictedScore -= 4; // High concern
        else if (fesTotal >= 30) predictedScore -= 3; // Moderate-high concern
        else if (fesTotal >= 20) predictedScore -= 1; // Moderate concern

        // TMT factor (slower time = lower balance)
        if (assessmentData.tmtTime > 30) predictedScore -= 3;
        else if (assessmentData.tmtTime > 20) predictedScore -= 1;

        // Physical activity factor (higher activity = better balance)
        // IPAQ scores can be large, use thresholds for impact.
        if (assessmentData.ipaqScore > 3000) predictedScore += 2; // Very active
        else if (assessmentData.ipaqScore < 600) predictedScore -= 2; // Low activity

        // Ensure score is within valid range (0-28)
        predictedScore = Math.max(0, Math.min(28, predictedScore));
        finalPredictedScore = predictedScore; // Store for download

        displayResults(predictedScore);
    }

    /**
     * Displays the calculated results as a full-screen page initially.
     * Sets a timeout to transition to the scrollable visualization page after a delay.
     * @param {number} score - The predicted Mini-BESTest score.
     */
    function displayResults(score) {
        const quizContainer = document.getElementById('quizContainer');
        const mainContent = document.getElementById('mainContent');
        const resultsPane = document.getElementById('resultsPane');
        const visualizationArea = document.getElementById('visualizationArea');

        clearTimeout(autoTransitionTimeout); // Clear any existing timeout

        // 1. Fade out quiz container
        quizContainer.style.opacity = 0;
        setTimeout(() => {
            quizContainer.style.display = 'none'; // Hide quiz container after fade out

            // 2. Prepare mainContent for full-screen results
            mainContent.style.display = 'flex'; // Enable flexbox for mainContent
            mainContent.style.opacity = 1; // Fade in mainContent
            mainContent.style.pointerEvents = 'auto'; // Enable interactions

            // Make resultsPane full screen, hide visualizationArea
            resultsPane.classList.add('full-screen-results');
            resultsPane.classList.remove('minimized'); // Ensure it's not minimized
            resultsPane.querySelector('.toggle-button').style.display = 'none'; // Hide toggle button

            // Explicitly hide visualizationArea by changing its display property
            visualizationArea.style.display = 'none'; // THIS IS CRUCIAL TO HIDE VISUALIZATIONS

            // Clear any old visualizations from the visualization area (in case of reset/re-run)
            d3.select('#viz1 svg').selectAll("*").remove();
            d3.select('#viz2 svg').selectAll("*").remove();
            d3.select('#viz3 svg').selectAll("*").remove();


            // Clear previous results content in resultsPane
            document.getElementById('predictedScore').textContent = '';
            document.getElementById('scoreInterpretation').innerHTML = '';
            document.getElementById('recommendations').innerHTML = '';
            d3.select('#comparisonChart').selectAll("*").remove(); // Ensure comparison chart SVG is empty


            // Populate results
            document.getElementById('predictedScore').textContent = score.toFixed(1);

            let interpretation = '';
            let recommendations = '';

            if (score >= 24) {
                interpretation = 'Excellent balance! Low fall risk.';
                recommendations = 'Continue your current activity level and consider challenging balance exercises to maintain your excellent balance.';
            } else if (score >= 20) {
                interpretation = 'Good balance with mild impairment.';
                recommendations = 'Consider incorporating more balance training exercises (e.g., tai chi, yoga, standing on one leg) and regular physical activity into your routine to further improve and maintain your balance.';
            } else if (score >= 16) {
                interpretation = 'Moderate balance impairment. Increased fall risk.';
                recommendations = 'Balance training is highly recommended. You should consider consulting a healthcare provider or a physical therapist for a personalized balance assessment and tailored exercise program.';
            } else {
                interpretation = 'Significant balance impairment. High fall risk.';
                recommendations = 'It is strongly advised that you consult with a healthcare provider, such as a doctor or physical therapist, for a comprehensive balance assessment and to develop a specialized training and fall prevention plan.';
            }

            document.getElementById('scoreInterpretation').innerHTML = `<p><strong>${interpretation}</strong></p>`;
            document.getElementById('recommendations').innerHTML = `<h3>Recommendations:</h3><p>${recommendations}</p>`;

            createComparisonChart(score); // Create chart to fill the full-screen results pane

            //     transitionToVizPage();
            // }, 6000); // **Increased delay to 6 seconds**
            // Add this to your results display function
            const exploreButton = document.createElement('button');
            exploreButton.textContent = 'Explore Your Results';
            exploreButton.className = 'explore-results-btn';
            exploreButton.onclick = transitionToVizPage;

            // Insert the button into the results content area, not the resultsPane container
            // Find a better container within resultsPane (like after recommendations)
            const recommendationsDiv = document.getElementById('recommendations');
            recommendationsDiv.appendChild(exploreButton);
        }, 500); // Match quizContainer opacity transition duration
    }

    /**
     * Transitions from the full-screen results page to the full-screen scrollable visualization page.
     * Minimizes the results pane to a corner and makes the visualization area full screen.
     */
    function transitionToVizPage() {
        const resultsPane = document.getElementById('resultsPane');
        const visualizationArea = document.getElementById('visualizationArea');
        const toggleButton = resultsPane.querySelector('.toggle-button');

        // Clear any automatic transition timeout if a manual toggle occurs
        clearTimeout(autoTransitionTimeout);

        // Remove full-screen-results class
        resultsPane.classList.remove('full-screen-results');

        // Minimize results pane to the corner
        resultsPane.classList.add('minimized');
        toggleButton.style.display = 'block'; // Show toggle button in minimized state
        toggleButton.textContent = 'Expand Results'; // Set initial text

        // Make visualizationArea visible and allow it to grow to full screen
        visualizationArea.style.display = 'flex'; // Ensure it's active in the flex container

        // Re-draw ALL D3 visualizations to ensure they fit the new full-screen visualization area
        renderAllVisualizations();
    }

    /**
     * Renders all D3 visualizations. This is called when the visualization area
     * changes size (e.g., when results pane is toggled or on initial transition).
     */
    function renderAllVisualizations() {
        createD3Visualization();
        createD3Visualization2();
        createD3Visualization3();
        // Call any other visualization rendering functions here
    }

    /**
     * Creates and displays a comparison chart of the user's score against a fictional population distribution.
     * Uses D3.js for visualization.
     * @param {number} userScore - The user's predicted Mini-BESTest score.
     */
    function createComparisonChart(userScore) {
        const chartContainer = d3.select('#comparisonChart');
        chartContainer.selectAll("*").remove(); // Clear previous chart to prevent duplication

        const svg = chartContainer
            .append('svg')
            .attr('viewBox', `0 0 600 350`); // Use viewBox for responsiveness

        const width = 600;
        const height = 350;
        const margin = {top: 40, right: 30, bottom: 60, left: 60};

        // Sample data representing study population distribution (fictional)
        const data = [
            {range: '0-7', count: 5, color: '#ff6b6b'},
            {range: '8-15', count: 15, color: '#feca57'},
            {range: '16-23', count: 45, color: '#48dbfb'},
            {range: '24-28', count: 35, color: '#1dd1a1'}
        ];

        const x = d3.scaleBand()
            .domain(data.map(d => d.range))
            .range([margin.left, width - margin.right])
            .padding(0.1);

        const y = d3.scaleLinear()
            .domain([0, d3.max(data, d => d.count) * 1.1]) // Add some padding to the top
            .range([height - margin.bottom, margin.top]);

        // Draw bars
        svg.selectAll('rect')
            .data(data)
            .enter()
            .append('rect')
            .attr('x', d => x(d.range))
            .attr('y', d => y(d.count))
            .attr('width', x.bandwidth())
            .attr('height', d => height - margin.bottom - y(d.count))
            .attr('fill', d => d.color)
            .attr('opacity', 0.8);

        // Add user score indicator
        const userRange = userScore <= 7 ? '0-7' :
                         userScore <= 15 ? '8-15' :
                         userScore <= 23 ? '16-23' : '24-28';

        const userXPos = x(userRange) + x.bandwidth() / 2;

        svg.append('line')
            .attr('x1', userXPos)
            .attr('x2', userXPos)
            .attr('y1', y(d3.max(data, d => d.count) * 1.05)) // Start above highest bar
            .attr('y2', height - margin.bottom)
            .attr('stroke', '#2c3e50')
            .attr('stroke-width', 3)
            .attr('stroke-dasharray', '5,5');

        svg.append('text')
            .attr('x', userXPos)
            .attr('y', y(d3.max(data, d => d.count) * 1.05) - 10)
            .attr('text-anchor', 'middle')
            .attr('font-weight', 'bold')
            .attr('fill', '#2c3e50')
            .text('Your Score');

        // Add axes
        svg.append('g')
            .attr('transform', `translate(0,${height - margin.bottom})`)
            .call(d3.axisBottom(x))
            .selectAll("text")
            .style("font-size", "12px");

        svg.append('g')
            .attr('transform', `translate(${margin.left},0)`)
            .call(d3.axisLeft(y).tickFormat(d => `${d}%`)) // Assuming percentages
            .selectAll("text")
            .style("font-size", "12px");

        // Add labels
        svg.append('text')
            .attr('x', width / 2)
            .attr('y', height - 10)
            .attr('text-anchor', 'middle')
            .style("font-size", "14px")
            .style("font-weight", "bold")
            .text('Mini-BESTest Score Range');

        svg.append('text')
            .attr('transform', 'rotate(-90)')
            .attr('x', -height / 2)
            .attr('y', 20)
            .attr('text-anchor', 'middle')
            .style("font-size", "14px")
            .style("font-weight", "bold")
            .text('Number of Participants (%)');

        // Title
        svg.append("text")
            .attr("x", (width / 2))
            .attr("y", margin.top / 2 + 5)
            .attr("text-anchor", "middle")
            .style("font-size", "18px")
            .style("font-weight", "bold")
            .text("Your Score vs. Population Distribution");
    }

    /**
     * Creates an example D3 visualization for "Balance Over Time".
     * Draws a simple line chart.
     */
    function createD3Visualization() {
      const svg = d3.select("#viz1 svg"); // Explicitly target SVG within viz1 container
      svg.selectAll("*").remove(); // Clear previous drawing

      // Get dynamic width and height from the SVG element
      const width = parseInt(svg.style("width"));
      const height = parseInt(svg.style("height"));
      const margin = { top: 20, right: 20, bottom: 30, left: 40 };

      const data = d3.range(20).map((_, i) => ({
        x: i,
        y: Math.sin(i / 2) * 5 + 20 + Math.random() * 5
      }));


      const x = d3.scaleLinear().domain([0, 19]).range([margin.left, width - margin.right]);
      const y = d3.scaleLinear().domain([10, 35]).range([height - margin.bottom, margin.top]);

      const line = d3.line()
        .x(d => x(d.x))
        .y(d => y(d.y));

      svg.append("path")
        .datum(data)
        .attr("fill", "none")
        .attr("stroke", "#2196F3")
        .attr("stroke-width", 2)
        .attr("d", line);

      svg.append("g")
        .attr("transform", `translate(0,${height - margin.bottom})`)
        .call(d3.axisBottom(x));

      svg.append("g")
        .attr("transform", `translate(${margin.left},0)`)
        .call(d3.axisLeft(y));
    }

    /**
     * Creates an example D3 visualization for "Visualization 2".
     * Draws a simple bar chart.
     */
    function createD3Visualization2() {
        const svg = d3.select("#viz2 svg"); // Explicitly target SVG within viz2 container
        svg.selectAll("*").remove(); // Clear previous drawing

        // Get dynamic width and height from the SVG element
        const width = parseInt(svg.style("width"));
        const height = parseInt(svg.style("height"));
        const margin = { top: 20, right: 20, bottom: 30, left: 40 };

        const data = [10, 20, 15, 25, 30, 18, 22]; // Example data

        const x = d3.scaleBand()
            .domain(d3.range(data.length))
            .range([margin.left, width - margin.right])
            .padding(0.1);

        const y = d3.scaleLinear()
            .domain([0, d3.max(data) * 1.2])
            .range([height - margin.bottom, margin.top]);

        svg.selectAll("rect")
            .data(data)
            .enter()
            .append("rect")
            .attr("x", (d, i) => x(i))
            .attr("y", d => y(d))
            .attr("width", x.bandwidth())
            .attr("height", d => height - margin.bottom - y(d))
            .attr("fill", "#66BB6A");

        svg.append("g")
            .attr("transform", `translate(0,${height - margin.bottom})`)
            .call(d3.axisBottom(x));

        svg.append("g")
            .attr("transform", `translate(${margin.left},0)`)
            .call(d3.axisLeft(y));
    }

    /**
     * Creates an example D3 visualization for "Visualization 3".
     * Draws a simple pie chart.
     */
    function createD3Visualization3() {
        const svg = d3.select("#viz3 svg"); // Explicitly target SVG within viz3 container
        svg.selectAll("*").remove(); // Clear previous drawing

        // Get dynamic width and height from the SVG element
        const width = parseInt(svg.style("width"));
        const height = parseInt(svg.style("height"));
        const radius = Math.min(width, height) / 2 - 20;

        const data = [
            { label: 'Activity A', value: 30 },
            { label: 'Activity B', value: 50 },
            { label: 'Activity C', value: 20 }
        ];

        const g = svg.append("g")
            .attr("transform", `translate(${width / 2},${height / 2})`);

        const color = d3.scaleOrdinal(d3.schemeCategory10);

        const pie = d3.pie()
            .value(d => d.value);

        const path = d3.arc()
            .outerRadius(radius - 10)
            .innerRadius(0);

        const arc = g.selectAll(".arc")
            .data(pie(data))
            .enter().append("g")
            .attr("class", "arc");

        arc.append("path")
            .attr("d", path)
            .attr("fill", d => color(d.data.label));

        arc.append("text")
            .attr("transform", d => `translate(${path.centroid(d)})`)
            .attr("text-anchor", "middle")
            .text(d => `${d.data.label} (${d.data.value}%)`)
            .attr("fill", "white")
            .style("font-size", "12px");
    }


    /**
     * Downloads the complete assessment results as a JSON file.
     */
    function downloadResults() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(assessmentData, null, 2));
        const dlAnchor = document.createElement('a');
        dlAnchor.setAttribute("href", dataStr);
        dlAnchor.setAttribute("download", "balance_assessment_full_results.json");
        dlAnchor.click();
    }

    /**
     * Downloads a summary of the predicted score and recommendations as a plain text file.
     */
    function downloadScore() {
        if (finalPredictedScore === null) {
            alert("Score not yet calculated. Please complete the quiz.");
            return;
        }

        const scoreText = `Your Predicted Mini-BESTest Score: ${finalPredictedScore.toFixed(1)}\n` +
                          `Interpretation: ${document.getElementById('scoreInterpretation').textContent}\n` +
                          `Recommendations: ${document.getElementById('recommendations').textContent.replace('Recommendations:', '').trim()}`;

        const dataStr = "data:text/plain;charset=utf-8," + encodeURIComponent(scoreText);
        const dlAnchor = document.createElement('a');
        dlAnchor.setAttribute("href", dataStr);
        dlAnchor.setAttribute("download", "balance_score_summary.txt");
        dlAnchor.click();
    }

    /**
     * Toggles the results pane between expanded (sidebar) and minimized (corner) states.
     * This function is primarily used on the visualization page.
     */
    function toggleResultsPane() {
        const resultsPane = document.getElementById('resultsPane');
        const visualizationArea = document.getElementById('visualizationArea');
        const toggleButton = resultsPane.querySelector('.toggle-button');

        // Clear any automatic transition timeout if a manual toggle occurs
        clearTimeout(autoTransitionTimeout);

        if (resultsPane.classList.contains('minimized')) {
            // Expand the pane (split-screen mode)
            resultsPane.classList.remove('minimized');
            toggleButton.textContent = 'Minimize Results';

            // Restore resultsPane to sidebar flex properties
            resultsPane.style.position = 'relative'; // Important for flexbox layout
            resultsPane.style.width = 'auto'; // Let flex-basis manage width
            resultsPane.style.height = '100vh'; // Fill height
            resultsPane.style.bottom = 'auto'; // Remove fixed positioning
            resultsPane.style.right = 'auto'; // Remove fixed positioning
            resultsPane.style.flex = '0 0 350px'; // Set to sidebar width
            resultsPane.style.padding = '20px'; // Restore original padding

            // Make sure visualization area is visible when expanded
            visualizationArea.style.display = 'flex'; // Ensure it's flex

            // Re-draw ALL D3 visualizations to fit the new (shrunk) visualization area size
            renderAllVisualizations();

        } else {
            // Minimize the pane (full-screen visualization mode)
            resultsPane.classList.add('minimized');
            toggleButton.textContent = 'Expand Results';

            // When resultsPane gets 'position: fixed', it's taken out of the flex flow.
            // visualizationArea, which has 'flex-grow: 1', will then naturally expand
            // to fill the entire remaining space of 'mainContent', thus becoming full screen.
            // No explicit style changes needed on visualizationArea for 'full-screen'.

            // Make sure visualization area is visible when minimized
            visualizationArea.style.display = 'flex'; // Ensure it's flex

            // Re-draw ALL D3 visualizations to fit the new (expanded) visualization area size
            renderAllVisualizations();
        }
    }

    /**
     * Resets the entire assessment, clearing all data and returning to the welcome screen.
     */
    function resetAssessment() {
        // Clear any pending timeouts
        clearTimeout(autoTransitionTimeout);

        currentStep = 0; // Reset to welcome screen
        assessmentData = {};
        tmtCompleted = false;
        tmtCurrentNumber = 1;
        tmtStartTime = null;
        finalPredictedScore = null; // Clear stored score

        // Reset all steps visibility
        document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
        document.getElementById('step0').classList.add('active'); // Show welcome screen

        // Clear all input fields and selections
        document.querySelectorAll('input').forEach(input => {
            if (input.type === 'number' || input.type === 'text') {
                input.value = '';
            }
        });
        document.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
        document.querySelectorAll('.likert-option').forEach(opt => opt.classList.remove('selected'));

        // Reset TMT display
        initializeTMT(); // This will clear and re-render the grid

        // Clear results section content in resultsPane
        document.getElementById('predictedScore').textContent = '';
        document.getElementById('scoreInterpretation').innerHTML = '';
        document.getElementById('recommendations').innerHTML = '';
        d3.select('#comparisonChart').selectAll("*").remove(); // Clear D3 comparison chart

        // Also clear visualizations in the visualization area
        d3.select('#viz1 svg').selectAll("*").remove();
        d3.select('#viz2 svg').selectAll("*").remove();
        d3.select('#viz3 svg').selectAll("*").remove();


        // Reset resultsPane and visualizationArea styles to initial (hidden/default) state
        const resultsPane = document.getElementById('resultsPane');
        const visualizationArea = document.getElementById('visualizationArea');
        const toggleButton = resultsPane.querySelector('.toggle-button');

        resultsPane.classList.remove('full-screen-results', 'minimized');
        resultsPane.style.display = 'flex'; // Default display for resultsPane
        resultsPane.style.flex = '0 0 350px'; // Default flex
        resultsPane.style.position = 'relative'; // Default position
        resultsPane.style.width = 'auto'; // Default width
        resultsPane.style.height = '100vh'; // Default height
        resultsPane.style.bottom = 'auto'; // Reset fixed position properties
        resultsPane.style.right = 'auto'; // Reset fixed position properties
        resultsPane.style.padding = '20px'; // Default padding
        toggleButton.style.display = 'block'; // Ensure toggle button is visible (will be hidden by .full-screen-results later)

        // *** CRITICAL FIX HERE: Ensure visualizationArea is hidden before mainContent is hidden ***
        visualizationArea.style.display = 'none'; // Hide visualization area explicitly

        // Hide main content split view with a fade-out and disable interactions
        document.getElementById('mainContent').style.opacity = 0;
        document.getElementById('mainContent').style.pointerEvents = 'none';
        setTimeout(() => {
            document.getElementById('mainContent').style.display = 'none'; // Hide mainContent after fade-out
        }, 500);

        // Show quiz container with a fade-in
        document.getElementById('quizContainer').style.display = 'block';
        document.getElementById('quizContainer').style.opacity = 1;

        // Reset the scroll position of the quiz container
        document.getElementById('quizContainer').scrollTop = 0;

        updateProgress();
    }

  </script>
</body>
</html>




