<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Age of Balance: Joe's Journey Through Life with Scrollama</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://unpkg.com/scrollama@3.2.0/build/scrollama.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
            background-color: #f0f4f8;
            color: #334155;
            margin: 0;
            padding: 0;
        }

        /* Scrollytelling Container */
        .scrolly-container {
            display: flex;
            align-items: flex-start;
            position: relative;
            min-height: 100vh;
            background-color: #f8fafc;
        }

        /* Graphic Area - Stays Fixed/Sticky */
        .scrolly-graphic {
            position: sticky;
            top: 0;
            width: 50%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #f8fafc;
            z-index: 5;
            overflow: hidden;
        }

        .scrolly-graphic canvas {
            width: 100%;
            height: 80%;
            display: block;
        }

        /* Balance scale visualization */
        .balance-scale {
            width: 80%;
            max-width: 400px;
            height: 60px;
            margin-top: 20px;
            position: relative;
            background: linear-gradient(to right, #ef4444 0%, #f97316 25%, #facc15 50%, #22c55e 75%, #22c55e 100%);
            border-radius: 30px;
            border: 2px solid #334155;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .balance-indicator {
            position: absolute;
            top: -5px;
            width: 20px;
            height: 70px;
            background-color: #334155;
            border-radius: 10px;
            transition: left 0.8s ease-in-out;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .balance-indicator::after {
            content: '';
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 10px solid #334155;
        }

        .balance-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: #64748b;
            font-weight: 600;
        }

        /* Text Area - Scrolls */
        .scrolly-text {
            width: 50%;
            z-index: 10;
            background-color: white;
            box-shadow: -5px 0 15px -3px rgba(0, 0, 0, 0.05);
        }

        /* Individual Step Sections */
        .scrolly-section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
        }
        .scrolly-section:last-of-type {
            border-bottom: none;
        }

        .section-content {
            max-width: 800px;
            margin-bottom: 2rem;
        }

        /* Quiz Section */
        .quiz-section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            background-color: #e2e8f0;
            color: #1a202c;
        }
        .quiz-container {
            background-color: white;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            max-width: 700px;
            width: 100%;
        }
        .quiz-question {
            margin-bottom: 1.5rem;
        }
        .quiz-options label {
            display: block;
            background-color: #f8fafc;
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            border: 1px solid #cbd5e1;
        }
        .quiz-options label:hover {
            background-color: #e0f2fe;
            border-color: #90cdf4;
        }
        .quiz-options input[type="radio"] {
            margin-right: 0.75rem;
            accent-color: #3b82f6;
        }
        .quiz-options input[type="radio"]:checked + span {
            font-weight: 600;
            color: #1e40af;
        }
        .quiz-submit-btn {
            background-color: #3b82f6;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            border: none;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3), 0 2px 4px -1px rgba(59, 130, 246, 0.1);
        }
        .quiz-submit-btn:hover {
            background-color: #2563eb;
            transform: translateY(-2px);
        }
        .quiz-submit-btn:active {
            transform: translateY(0);
        }
        .quiz-results {
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: #e0f2fe;
            border-radius: 0.75rem;
            border: 1px solid #90cdf4;
            color: #1e40af;
        }

        /* Custom Modal Styling */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            max-width: 450px;
            width: 90%;
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
        }
        .modal-overlay.show .modal-content {
            transform: translateY(0);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e40af;
        }
        .modal-close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
            transition: color 0.2s;
        }
        .modal-close-btn:hover {
            color: #334155;
        }
        .modal-body {
            margin-bottom: 1.5rem;
            color: #475569;
        }
        .modal-footer {
            text-align: right;
        }
        .modal-ok-btn {
            background-color: #3b82f6;
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .modal-ok-btn:hover {
            background-color: #2563eb;
        }

        /* Media queries for responsiveness */
        @media (max-width: 768px) {
            .scrolly-container {
                flex-direction: column;
            }
            .scrolly-graphic, .scrolly-text {
                width: 100%;
            }
            .scrolly-graphic {
                height: 50vh;
                position: sticky;
                top: 0;
            }
            .scrolly-section {
                min-height: 75vh;
            }
        }
    </style>
</head>
<body>

    <div class="scrolly-container">
        <div class="scrolly-graphic">
            <canvas id="main-canvas"></canvas>
            <div class="balance-scale">
                <div class="balance-indicator" id="balance-indicator"></div>
            </div>
            <div class="balance-labels">
                <span>Poor Balance</span>
                <span>Excellent Balance</span>
            </div>
        </div>
        <div class="scrolly-text">
            <div class="scrolly-section" data-age="intro">
                <div class="section-content">
                    <h1 class="text-5xl font-bold mb-6 text-gray-800">The Age of Balance: Joe's Journey Through Life</h1>
                    <p class="text-xl text-gray-600 mb-8">Scroll down to follow Joe's fascinating journey and discover how balance evolves throughout our lives. Watch the balance meter on the left!</p>
                    <i class="fas fa-chevron-down text-4xl text-blue-500 animate-bounce"></i>
                </div>
            </div>

            <div class="scrolly-section" data-age="toddler">
                <div class="section-content">
                    <h2 class="text-4xl font-bold mb-4 text-gray-800">Joe as a Toddler: Wobbly Beginnings</h2>
                    <p class="text-lg text-gray-700">From crawling to taking his first steps, Joe's toddler years are a masterclass in learning balance. Every stumble is a lesson, as his brain and muscles work tirelessly to coordinate movements and maintain an upright posture. It's a period of rapid development, filled with adorable wobbles and triumphant steps.</p>
                    <p class="text-md text-gray-600 mt-4">At this stage, core strength, visual input, and trial-and-error are crucial for building foundational balance skills.</p>
                </div>
            </div>

            <div class="scrolly-section" data-age="20">
                <div class="section-content">
                    <h2 class="text-4xl font-bold mb-4 text-gray-800">Joe at 20: The Peak of Stability</h2>
                    <p class="text-lg text-gray-700">At 20, Joe feels invincible. His balance is at its peak, rarely a second thought. Whether he's playing sports, dancing, or just navigating a crowded street, his body's systems work in perfect harmony to keep him upright and agile.</p>
                    <p class="text-md text-gray-600 mt-4">This is when proprioception (body awareness), vestibular function (inner ear balance), and strong muscles are all working optimally.</p>
                </div>
            </div>

            <div class="scrolly-section" data-age="40">
                <div class="section-content">
                    <h2 class="text-4xl font-bold mb-4 text-gray-800">Joe at 40: Subtle Shifts Begin</h2>
                    <p class="text-lg text-gray-700">By 40, life gets busy. Joe might not notice it, but his reaction time and spatial awareness begin a subtle, gradual decline. He might occasionally stumble over an unseen obstacle or feel a slight wobble when standing on one leg. These changes are often imperceptible in daily life but mark the beginning of age-related balance shifts.</p>
                    <p class="text-md text-gray-600 mt-4">Factors like reduced muscle mass, less flexible joints, and minor changes in sensory input can contribute to these early shifts.</p>
                </div>
            </div>

            <div class="scrolly-section" data-age="60">
                <div class="section-content">
                    <h2 class="text-4xl font-bold mb-4 text-gray-800">Joe at 60: Noticing the Changes</h2>
                    <p class="text-lg text-gray-700">At 60, Joe's body is changing more noticeably. He might find himself reaching for support more often, especially on uneven surfaces or in low light. Regular exercise and mindful movement become crucial for maintaining his stability and preventing falls. He's more aware of the need to be careful.</p>
                    <p class="text-md text-gray-600 mt-4">Vision changes, slower nerve impulses, and decreased strength in core and leg muscles play a significant role here.</p>
                </div>
            </div>

            <div class="scrolly-section" data-age="80">
                <div class="section-content">
                    <h2 class="text-4xl font-bold mb-4 text-gray-800">Joe at 80+: Prioritizing Safety</h2>
                    <p class="text-lg text-gray-700">Into his 80s, Joe prioritizes safety and independence. He might use assistive devices like a cane or walker, and he's more cautious about his environment. Simple home modifications and consistent, gentle exercise help him stay active and minimize fall risks. Maintaining balance is now a conscious effort and a key to his quality of life.</p>
                    <p class="text-md text-gray-600 mt-4">Increased risk of falls, slower reflexes, and potential chronic conditions can impact balance significantly at this age.</p>
                </div>
            </div>
        </div> 
    </div> 
    
    <div class="quiz-section" id="quiz-section">
        <div class="quiz-container">
            <h2 class="text-4xl font-bold mb-6 text-gray-800 text-center">Assess Your Own Balance Journey</h2>
            <p class="text-lg text-gray-700 mb-8 text-center">Answer these questions to get insights into your balance and discover personalized tips.</p>

            <form id="balance-quiz">
            </form>

            <button type="button" id="submit-quiz" class="quiz-submit-btn w-full">Get My Balance Insights</button>

            <div id="quiz-results" class="quiz-results hidden">
                <h3 class="text-2xl font-semibold mb-3">Your Balance Insights:</h3>
                <p id="result-text" class="text-lg"></p>
                <p class="text-md mt-4 font-medium">Remember, balance can always be improved or maintained with conscious effort and appropriate exercises!</p>
            </div>
        </div>
    </div>

    <div id="customModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <span id="modalTitle">Message</span>
                <button class="modal-close-btn" id="modalCloseBtn">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                This is a custom message.
            </div>
            <div class="modal-footer">
                <button class="modal-ok-btn" id="modalOkBtn">OK</button>
            </div>
        </div>
    </div>

    <script>
        // Custom Modal Functions
        const customModal = document.getElementById('customModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const modalCloseBtn = document.getElementById('modalCloseBtn');
        const modalOkBtn = document.getElementById('modalOkBtn');

        function showCustomModal(title, message) {
            modalTitle.textContent = title;
            modalBody.textContent = message;
            customModal.classList.add('show');
        }

        function hideCustomModal() {
            customModal.classList.remove('show');
        }

        modalCloseBtn.addEventListener('click', hideCustomModal);
        modalOkBtn.addEventListener('click', hideCustomModal);
        customModal.addEventListener('click', (e) => {
            if (e.target === customModal) {
                hideCustomModal();
            }
        });

        // Canvas Drawing Logic
        const mainCanvas = document.getElementById('main-canvas');
        const mainCtx = mainCanvas.getContext('2d');
        const balanceIndicator = document.getElementById('balance-indicator');
        let currentActiveAge = null;
        let animationFrameId = null;

        // Balance scale position mapping
        const balancePositions = {
            'intro': 50, // Neutral/center
            'toddler': 25, // Learning stage - wobbling
            20: 85, // Peak balance
            40: 70, // Good balance
            60: 40, // Declining balance
            80: 15  // Poor balance
        };

        function updateBalanceIndicator(age) {
            const position = balancePositions[age] || 50;
            balanceIndicator.style.left = `calc(${position}% - 10px)`;
            console.log(`Balance indicator moved to ${position}% for age ${age}`);
        }

        /**
         * Draws Joe's stick figure on the canvas.
         */
        function drawJoe(ctx, x, yBase, scale, tiltAngle = 0, wobble = 0, hasBraces = false, stoopAngle = 0) {
            ctx.save();
            ctx.translate(x, yBase);
            ctx.rotate(tiltAngle);

            const headRadius = 10 * scale;
            const bodyLength = 40 * scale;
            const limbLength = 30 * scale;

            const currentWobble = Math.sin(Date.now() * 0.005) * wobble;
            ctx.rotate(currentWobble);

            ctx.lineWidth = 2 * scale;
            ctx.strokeStyle = '#334155';
            ctx.fillStyle = '#334155';

            // Legs
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(-limbLength * 0.5, limbLength);
            ctx.moveTo(0, 0);
            ctx.lineTo(limbLength * 0.5, limbLength);
            ctx.stroke();

            // Body with stoop
            ctx.save();
            ctx.rotate(-stoopAngle);
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(0, -bodyLength);
            ctx.stroke();

            // Arms
            ctx.beginPath();
            ctx.moveTo(0, -bodyLength * 0.75);
            ctx.lineTo(-limbLength * 0.7, -bodyLength * 0.5);
            ctx.moveTo(0, -bodyLength * 0.75);
            ctx.lineTo(limbLength * 0.7, -bodyLength * 0.5);
            ctx.stroke();

            // Head
            ctx.beginPath();
            ctx.arc(0, -bodyLength - headRadius, headRadius, 0, Math.PI * 2);
            ctx.fill();

            // Braces if needed
            if (hasBraces) {
                ctx.fillStyle = '#a0aec0';
                const braceWidth = 16 * scale;
                const braceHeight = 3 * scale;
                ctx.fillRect(-braceWidth / 2, -bodyLength - headRadius * 0.5 + 5 * scale, braceWidth, braceHeight);
                ctx.fillRect(-braceWidth / 2, -bodyLength - headRadius * 0.4 + 5 * scale, braceWidth, braceHeight);
            }
            ctx.restore();
            ctx.restore();
        }

        /**
         * Draws the balance visualization based on age.
         */
        function drawBalanceVisualization(ctx, age) {
            if (!ctx) return;

            ctx.canvas.width = ctx.canvas.offsetWidth;
            ctx.canvas.height = ctx.canvas.offsetHeight;
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);

            const centerX = ctx.canvas.width / 2;
            const joeGroundY = ctx.canvas.height * 0.8;
            const baseScale = Math.min(ctx.canvas.width, ctx.canvas.height) / 300;

            // Age-specific parameters
            let joeTilt = 0;
            let joeWobble = 0;
            let joeImageScale = 1;
            let hasBraces = false;
            let showCane = false;
            let stoopAngle = 0;

            switch (age) {
                case 'intro':
                    joeImageScale = 0.3;
                    joeTilt = 0;
                    joeWobble = 0;
                    hasBraces = false;
                    showCane = false;
                    stoopAngle = 0;
                    break;
                case 'toddler':
                    joeImageScale = 0.6;
                    joeTilt = Math.sin(Date.now() * 0.008) * 0.25;
                    joeWobble = 0.15;
                    hasBraces = false;
                    showCane = false;
                    stoopAngle = 0;
                    break;
                case 20:
                    joeImageScale = 1.0;
                    hasBraces = true;
                    joeTilt = 0;
                    joeWobble = 0;
                    showCane = false;
                    stoopAngle = 0;
                    break;
                case 40:
                    joeImageScale = 1.0;
                    joeTilt = Math.sin(Date.now() * 0.003) * 0.1;
                    joeWobble = 0.05;
                    hasBraces = false;
                    showCane = false;
                    stoopAngle = 0.05;
                    break;
                case 60:
                    joeImageScale = 1.0;
                    joeTilt = Math.sin(Date.now() * 0.004) * 0.2;
                    joeWobble = 0.1;
                    hasBraces = false;
                    showCane = false;
                    stoopAngle = 0.2;
                    break;
                case 80:
                    joeImageScale = 0.8;
                    joeTilt = Math.sin(Date.now() * 0.005) * 0.3;
                    joeWobble = 0.15;
                    hasBraces = false;
                    showCane = true;
                    stoopAngle = 0.35;
                    break;
            }

            // Draw Joe
            drawJoe(ctx, centerX, joeGroundY, baseScale * joeImageScale, joeTilt, joeWobble, hasBraces, stoopAngle);

            // Draw ground line
            ctx.beginPath();
            ctx.moveTo(centerX - 100 * baseScale, joeGroundY);
            ctx.lineTo(centerX + 100 * baseScale, joeGroundY);
            ctx.lineWidth = 3 * baseScale;
            ctx.strokeStyle = '#64748b';
            ctx.stroke();

            // Draw cane if needed
            if (showCane) {
                ctx.font = `${45 * baseScale}px "Font Awesome 6 Free"`;
                ctx.fillStyle = '#8B4513';
                ctx.fillText('\uf787', centerX + 35 * baseScale * joeImageScale, joeGroundY + 5 * baseScale);
            }

            // Continue animation if this is the active age
            if (age === currentActiveAge) {
                animationFrameId = requestAnimationFrame(() => drawBalanceVisualization(ctx, age));
            }
        }

        // Scrollama Setup
        function handleStepEnter(response) {
            console.log('Step entered:', response.element.dataset.age);
            
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }

            const age = response.element.dataset.age;
            currentActiveAge = age;
            
            // Update balance indicator
            updateBalanceIndicator(age);
            
            // Start animation
            drawBalanceVisualization(mainCtx, age);
        }

        function setupScrollama() {
            if (typeof scrollama === 'undefined') {
                console.error('Scrollama not available, using fallback');
                useScrollFallback();
                return;
            }

            try {
                const scroller = scrollama();
                scroller
                    .setup({
                        step: '.scrolly-section',
                        offset: 0.5,
                    })
                    .onStepEnter(handleStepEnter);
                
                console.log('Scrollama setup complete');
            } catch (error) {
                console.error('Scrollama setup failed:', error);
                useScrollFallback();
            }
        }

        function useScrollFallback() {
            console.log('Using basic scroll fallback');
            
            function checkScroll() {
                const sections = document.querySelectorAll('.scrolly-section');
                const windowHeight = window.innerHeight;
                
                sections.forEach(section => {
                    const rect = section.getBoundingClientRect();
                    const isVisible = rect.top < windowHeight * 0.5 && rect.bottom > windowHeight * 0.5;
                    
                    if (isVisible) {
                        const age = section.dataset.age;
                        if (age !== currentActiveAge) {
                            if (animationFrameId) {
                                cancelAnimationFrame(animationFrameId);
                                animationFrameId = null;
                            }
                            
                            currentActiveAge = age;
                            updateBalanceIndicator(age);
                            drawBalanceVisualization(mainCtx, currentActiveAge);
                            console.log('Fallback: Switched to age', age);
                        }
                    }
                });
            }
            
            let scrollTimeout;
            window.addEventListener('scroll', function() {
                if (scrollTimeout) {
                    clearTimeout(scrollTimeout);
                }
                scrollTimeout = setTimeout(checkScroll, 50);
            });
            
            checkScroll();
        }

        // Quiz Logic
        const quizQuestions = [
            {
                question: "How often do you feel unsteady or lose your balance during daily activities?",
                options: [
                    { text: "Never or almost never", value: 5 },
                    { text: "Rarely (a few times a year)", value: 4 },
                    { text: "Occasionally (a few times a month)", value: 3 },
                    { text: "Sometimes (a few times a week)", value: 2 },
                    { text: "Frequently (daily or almost daily)", value: 1 }
                ]
            },
            {
                question: "When walking, do you tend to look down at your feet or around at your surroundings?",
                options: [
                    { text: "Around at my surroundings", value: 5 },
                    { text: "Mostly around, sometimes down", value: 4 },
                    { text: "About half and half", value: 3 },
                    { text: "Mostly down at my feet", value: 2 },
                    { text: "Always down at my feet", value: 1 }
                ]
            },
            {
                question: "How easily can you stand on one leg for 10 seconds (without holding onto anything)?",
                options: [
                    { text: "Very easily", value: 5 },
                    { text: "Easily", value: 4 },
                    { text: "With some difficulty", value: 3 },
                    { text: "With great difficulty", value: 2 },
                    { text: "Cannot do it", value: 1 }
                ]
            },
            {
                question: "How often do you engage in activities that challenge your balance (e.g., yoga, tai chi, dancing, walking on uneven surfaces)?",
                options: [
                    { text: "Daily or almost daily", value: 5 },
                    { text: "Several times a week", value: 4 },
                    { text: "Once a week", value: 3 },
                    { text: "Rarely", value: 2 },
                    { text: "Never", value: 1 }
                ]
            },
            {
                question: "Do you have any medical conditions or take medications that you know affect your balance?",
                options: [
                    { text: "No, none that I know of", value: 5 },
                    { text: "Possibly, but I'm not sure", value: 3 },
                    { text: "Yes, one or more conditions/medications", value: 1 }
                ]
            }
        ];

        const quizForm = document.getElementById('balance-quiz');
        const submitQuizBtn = document.getElementById('submit-quiz');
        const quizResultsDiv = document.getElementById('quiz-results');
        const resultText = document.getElementById('result-text');

        function renderQuiz() {
            quizForm.innerHTML = '';
            quizQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.classList.add('quiz-question');
                questionDiv.innerHTML = `
                    <p class="text-xl font-semibold mb-3 text-gray-800">${index + 1}. ${q.question}</p>
                    <div class="quiz-options">
                        ${q.options.map((option, optIndex) => `
                            <label>
                                <input type="radio" name="question${index}" value="${option.value}" required>
                                <span>${option.text}</span>
                            </label>
                        `).join('')}
                    </div>
                `;
                quizForm.appendChild(questionDiv);
            });
        }

        function calculateScore() {
            let totalScore = 0;
            let allAnswered = true;
            quizQuestions.forEach((q, index) => {
                const selectedOption = quizForm.querySelector(`input[name="question${index}"]:checked`);
                if (selectedOption) {
                    totalScore += parseInt(selectedOption.value);
                } else {
                    allAnswered = false;
                }
            });
            return { score: totalScore, allAnswered: allAnswered };
        }

        function displayResults(score) {
            let message = '';
            if (score >= 20) {
                message = `Excellent Balance! Your score of ${score} indicates strong balance. Keep up your active lifestyle and continue to challenge your balance regularly.`;
            } else if (score >= 15) {
                message = `Good Balance! Your score of ${score} suggests good balance. Consider incorporating more balance-specific exercises like yoga or tai chi to maintain and further improve your stability.`;
            } else if (score >= 10) {
                message = `Moderate Balance. Your score of ${score} indicates that your balance could use some attention. Focus on exercises that strengthen your core and legs, and practice standing on one leg with support. Consult a healthcare professional if you have concerns.`;
            } else {
                message = `Balance Concerns. Your score of ${score} suggests significant balance challenges. It's highly recommended to consult a doctor or physical therapist to assess your balance and create a personalized plan to improve your stability and reduce fall risk.`;
            }
            resultText.textContent = message;
            quizResultsDiv.classList.remove('hidden');
        }

        submitQuizBtn.addEventListener('click', () => {
            const { score, allAnswered } = calculateScore();
            if (allAnswered) {
                displayResults(score);
                quizResultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
                showCustomModal('Incomplete Quiz', 'Please answer all questions before submitting.');
            }
        });

        // Initialize on window load
        window.onload = function() {
            console.log('Window loaded, initializing...');
            
            if (mainCanvas) {
                mainCanvas.width = mainCanvas.offsetWidth;
                mainCanvas.height = mainCanvas.offsetHeight;
                console.log('Canvas initialized:', mainCanvas.width, 'x', mainCanvas.height);
            }
            
            if (typeof scrollama !== 'undefined') {
                console.log('Scrollama available, setting up normally');
                setupScrollama();
            } else {
                console.log('Scrollama not available, using fallback');
                useScrollFallback();
            }
            
            renderQuiz();
            
            // Initialize with intro
            currentActiveAge = 'intro';
            updateBalanceIndicator('intro');
            drawBalanceVisualization(mainCtx, currentActiveAge);
            console.log('Initial draw triggered for intro');
        };

    </script>
</body>
</html>